# .github/workflows/main.yml
name: Daily HMM Update

on:
  schedule:
    # Run daily at 21:30 UTC 
    - cron: '30 21 * * *'
  workflow_dispatch: # Allows manual trigger

jobs:
  update-hmm-data:
    runs-on: ubuntu-latest
    permissions: 
      contents: write # Grants permission to push files back
      
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies (Assuming a requirements.txt exists)
        run: pip install -r requirements.txt
        # ALTERNATIVE: run: pip install pandas numpy yfinance hmmlearn

      - name: Run HMM script and generate data
        run: python run_hmm.py
        # The run_hmm.py script generates the docs/chart_data.json file

      - name: Commit and push new JSON data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # This action handles configuration, adding, committing, and pushing for you
          file_pattern: 'docs/chart_data.json' 
          commit_message: 'ðŸ¤– Data: Automated HMM data update'
